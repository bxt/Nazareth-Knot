<%

require_relative '../helpers.rb'

size = 150

page_intro("Bernani", :black, 'May 2018')

A_COUNT = 600
B_COUNT = 60
A_DUR = 100

def cumsum(a)
  a.inject([]) { |x, y| x + [(x.last || 0) + y] }
end

particles = A_COUNT.times.map do |i|
  percentage = i.to_f/A_COUNT
  delay = '%gs' % (percentage*A_DUR).round(3)
  opacity = (percentage*B_COUNT) % 1
  style = "animation-delay: -#{delay}; fill: #{mix_color('#f60', '#324', opacity)};"
  [opacity, style]
end.sort.map { |x,y| y }

%>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" xml:lang="en" viewBox="<%= -size/2 %> <%= -size/2 %> <%= size %> <%= size %>" id="knot">
  <defs>
    <style>

      .path {
        offset-path: path('m -51.084954,-29.510428 0,26.3984249 16.16015,0 c 6.44,0 9.51953,-2.31898 9.51953,-6.9589799 0,-3.4 -2.04062,-5.80125 -6.64062,-6.28125 l 0,-0.0391 c 4.08,-0.559995 5.96094,-2.920075 5.96094,-6.080075 0,-4.68 -3.20086,-6.99906 -9.88086,-7.03906 l -15.11914,0 z m 28.20312,0 0,26.3984249 22.40039016,0 0,-6.83984 -13.08008016,0 0,-3.1191399 10.1601602,0 0,-6.320305 -10.1601602,0 0,-3.2793 12.59961016,0 0,-6.83984 -21.91992016,0 z m 25.0781302,0 0,26.3984249 9.1191388,0 0,-8.7597599 2.56054,0 4.67969,8.7597599 10.1211,0 -6.24024,-9.7597599 c 3.16,-1.32 4.75977,-3.918825 4.75977,-7.798825 0,-5.88 -3.63969,-8.83985 -10.67969,-8.83984 l -14.3203088,0 z m 28.2031188,0 0,26.3984249 8.08008,0 0,-9.7988299 -0.16016,-5.441395 0.0801,0 1.43945,3.240225 6.32032,11.9999999 10.08008,0 0,-26.3984249 -8.08008,0 0,9.79882 0.16015,5.439455 -0.0801,0 -1.43946,-3.199215 -6.32031,-12.03906 -10.08008,0 z m -72.564449,6.39843 4.08008,0 c 1.68,0 2.48047,0.63992 2.48047,1.91992 0,1.28 -0.80047,1.91993 -2.48047,1.91993 l -4.08008,0 0,-3.83985 z m 53.480469,0.24024 3.32031,0 c 2.36,0 3.24023,0.6814 3.24023,2.4414 0,1.8 -0.88023,2.43946 -3.24023,2.43946 l -3.32031,0 0,-4.88086 z m -53.480469,9.839835 4.75976,0 c 1.68,0 2.48047,0.64086 2.48047,1.88086 0,1.3199999 -0.80047,1.9589799 -2.48047,1.9589799 l -4.75976,0 0,-3.8398399 z m -8.91992,12.19140993 0,26.39843007 9.32031,0 0,-9.83984 7.24023,0 0,9.83984 9.32032,0 0,-26.39843007 -9.32032,0 0,9.71874997 -7.24023,0 0,-9.71874997 -9.32031,0 z m 36.08203,0 -8.56055,26.39843007 9.28125,0 1.23828,-5.03906 7.1211002,0 1.19921,5.03906 9.519539,0 -8.599609,-26.39843007 -11.1992202,0 z m 21.4179692,0 0,26.39843007 9.1191398,0 0,-8.75976 2.56054,0 4.67969,8.75976 10.1211,0 -6.24024,-9.75976 c 3.16,-1.32 4.75977,-3.91883 4.75977,-7.7988301 0,-5.88 -3.63969,-8.83983997 -10.67969,-8.83983997 l -14.3203098,0 z m 28.2031198,0 0,26.39843007 12.95899,0 c 8.28,0 12.52148,-4.79921 12.52148,-13.19921 0,-8.4000001 -4.24148,-13.19922007 -12.52148,-13.19922007 l -12.95899,0 z m -19.08398,6.63866997 3.32031,0 c 2.36,0 3.24023,0.67945 3.24023,2.43945 0,1.8000001 -0.88023,2.4414101 -3.24023,2.4414101 l -3.32031,0 0,-4.8808601 z m 28.40429,0 2.32032,0 c 3.44,0 4.31836,2.04055 4.31836,6.5605501 0,4.52 -0.87836,6.56054 -4.31836,6.56054 l -2.32032,0 0,-13.1210901 z m -53.4609288,0.12109 0.11914,0 2.12109,8.7988301 -4.3613302,0 1.08008,-4.32031 1.0410202,-4.4785201 z');
        animation: runani <%= A_DUR %>s linear infinite;
      }

      @keyframes runani {
        0% { offset-distance: 0; }
        to { offset-distance: 100%; }
      }
    </style>
    <path id="path-b" d="M 2 0 L 0 -0.6 L 0 0.6 Z" />
  </defs>
  <% particles.each do |style| %>
    <use xlink:href="#path-b" class="path" style="<%= style %>" />
  <% end %>
</svg>
